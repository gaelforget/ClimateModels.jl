<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · ClimateModels.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimateModels.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#Climate-Model-Interface"><span>Climate Model Interface</span></a></li><li><a class="tocitem" href="#Git-Support"><span>Git Support</span></a></li><li><a class="tocitem" href="#Cloud-Support"><span>Cloud Support</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Guide </a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/defaults/">Default Behavior (Julia Package)</a></li><li><a class="tocitem" href="../generated/RandomWalker/">Default Behavior (Julia Function)</a></li><li><a class="tocitem" href="../generated/ShallowWaters/">Shallow Water Model (Julia)</a></li><li><a class="tocitem" href="../generated/Hector/">Hector Global Climate (C++)</a></li><li><a class="tocitem" href="../generated/MITgcm/">General Circulation Model (Fortran)</a></li><li><a class="tocitem" href="../generated/Speedy/">SPEEDY Atmosphere (Fortran)</a></li><li><a class="tocitem" href="../generated/CMIP6/">CMIP6 Models (Cloud Archive)</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gaelforget/ClimateModels.jl/blob/master/docs/src/functionalities.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="manual"><a class="docs-heading-anchor" href="#manual">Manual / User Guide</a><a id="manual-1"></a><a class="docs-heading-anchor-permalink" href="#manual" title="Permalink"></a></h1><p>Here we document key functionalities offered in <code>ClimateModels.jl</code></p><h2 id="Climate-Model-Interface"><a class="docs-heading-anchor" href="#Climate-Model-Interface">Climate Model Interface</a><a id="Climate-Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Climate-Model-Interface" title="Permalink"></a></h2><p>The climate model interface is based on a data structure (<code>ModelConfig</code>) and a series of methods like <code>setup</code>, <code>build</code>, and <code>launch</code>. The default assumption is that the model is either <em>1)</em> a <code>Julia</code> package to be downloaded from a URL within <code>setup</code> using <code>Pkg.develop</code>, and run within <code>launch</code> using <code>Pkg.test</code> or <em>2)</em> a <code>Julia</code> function to be called with a <code>ModelConfig</code> argument. </p><p>A key point is that everything can be customized to e.g. <code>1)</code> use a custom workflow instead of <code>Pkg.test</code> or <code>2)</code> use popular models previously written in Fortran or C just as simply. The latter typically involves calling a <code>build</code> method to compile the model between <code>setup</code> and <code>launch</code>.</p><p>Leveraging the interface in real world application essentially means :</p><ol><li>Define a concrete type <code>ModelConfig</code> (optional).</li><li>Customize interface methods to best suit your chosen model.</li></ol><p>At first, one can skip the type definition (<code>#1</code> above) and may only want to customize <code>setup</code> and <code>launch</code> for <code>#2</code> (see examples 1, 2, and 3).</p><p>However, the idea is that for routine use of e.g. a popular model the customized interface elements would be provided via a dedicated package (e.g. <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a>). These customized interfaces would thus be maintained independently by developers and users most familiar with each model.</p><p>This approach is illustrated in the general circulation model example that uses the customized interface elements provided by <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a> for <a href="https://mitgcm.readthedocs.io/en/latest/">MITgcm</a>.</p><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.ModelConfig" href="#ClimateModels.ModelConfig"><code>ClimateModels.ModelConfig</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct ModelConfig &lt;: AbstractModelConfig</code></pre><pre><code class="nohighlight hljs">model :: Union{Function,String,Pkg.Types.PackageSpec} = &quot;anonymous&quot;
configuration :: Union{Function,String} = &quot;anonymous&quot;
options :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
inputs :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
outputs :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
status :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
channel :: Channel{Any} = Channel{Any}(10) 
folder :: String = tempdir()
ID :: UUID = UUIDs.uuid4()</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL6-L20">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.setup" href="#ClimateModels.setup"><code>ClimateModels.setup</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup(x)</code></pre><p>Defaults to <code>default_ClimateModelSetup(x)</code>. Can be expected to be  specialized for most concrete types of <code>AbstractModelConfig</code></p><pre><code class="language-julia hljs">using ClimateModels, Suppressor, OrderedCollections
inputs=OrderedDict(); inputs[&quot;NS&quot;]=1000;
tmp=ModelConfig(model=ClimateModels.RandomWalker,inputs=inputs)
setup(tmp)

build(tmp)
launch(tmp)
git_log_fil(tmp,&quot;tracked_parameters.toml&quot;,&quot;update tracked_parameters.toml (or skip)&quot;)
@suppress git_log_show(tmp)
isa(tmp,AbstractModelConfig)

# output

true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL34-L56">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.build" href="#ClimateModels.build"><code>ClimateModels.build</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">build(x)</code></pre><p>Defaults to <code>default_ClimateModelBuild(x)</code>. Can be expected to be  specialized for most concrete types of <code>AbstractModelConfig</code></p><pre><code class="language-julia hljs">using ClimateModels, Pkg
tmp0=PackageSpec(url=&quot;https://github.com/JuliaOcean/AirSeaFluxes.jl&quot;)
tmp=ModelConfig(model=tmp0,configuration=&quot;anonymous&quot;)
setup(tmp)
build(tmp)

isa(tmp,AbstractModelConfig)

# output

true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL153-L172">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.compile" href="#ClimateModels.compile"><code>ClimateModels.compile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compile(x)</code></pre><p>Defaults to <code>default_ClimateModelBuild(x)</code>. Can be expected to be  specialized for most concrete types of <code>AbstractModelConfig</code></p><pre><code class="language-julia hljs">using ClimateModels, Pkg
tmp0=PackageSpec(url=&quot;https://github.com/JuliaOcean/AirSeaFluxes.jl&quot;)
tmp=ModelConfig(model=tmp0)
setup(tmp)
compile(tmp)

isa(tmp,AbstractModelConfig)

# output

true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL175-L194">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.clean" href="#ClimateModels.clean"><code>ClimateModels.clean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">clean(x :: AbstractModelConfig)</code></pre><p>Cancel any remaining task (x.channel) and clean the run directory (via rm)</p><pre><code class="nohighlight hljs">tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
clean(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL229-L239">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.launch" href="#ClimateModels.launch"><code>ClimateModels.launch</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">launch(x)</code></pre><p>Defaults to <code>default_ClimateModelLaunch(x)</code> which consists in <code>take!(x)</code> for <code>AbstractModelConfig</code>. Can be expected to be specialized for most  concrete types of <code>AbstractModelConfig</code></p><pre><code class="nohighlight hljs">tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
launch(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL210-L222">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.monitor" href="#ClimateModels.monitor"><code>ClimateModels.monitor</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">monitor(x)</code></pre><p>Show <code>x.status[end]</code> by default.</p><pre><code class="nohighlight hljs">tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
monitor(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL253-L263">source</a></section></article><h2 id="Git-Support"><a class="docs-heading-anchor" href="#Git-Support">Git Support</a><a id="Git-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Git-Support" title="Permalink"></a></h2><p>The <code>setup</code> method normally calls <code>git_log_init</code> to set up a temporary run folder with a <code>git</code> enabled subfolder called <code>log</code>. This allows for recording each workflow step, using functions listed here for example.</p><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.git_log_init" href="#ClimateModels.git_log_init"><code>ClimateModels.git_log_init</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">git_log_init(x :: AbstractModelConfig)</code></pre><p>Create <code>log</code> subfolder, initialize git, and commit initial README.md</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL84-L88">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.git_log_msg" href="#ClimateModels.git_log_msg"><code>ClimateModels.git_log_msg</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">git_log_msg(x :: AbstractModelConfig,msg,commit_msg)</code></pre><p>Add message <code>msg</code> to the <code>log/README.md</code> file and git commit.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL373-L377">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.git_log_fil" href="#ClimateModels.git_log_fil"><code>ClimateModels.git_log_fil</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">git_log_fil(x :: AbstractModelConfig,fil,commit_msg)</code></pre><p>Commit changes to file <code>log/fil</code> with message <code>commit_msg</code>. If <code>log/fil</code> is  unknown to git (i.e. commit errors out) then try adding <code>log/fil</code> first. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL392-L397">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.git_log_prm" href="#ClimateModels.git_log_prm"><code>ClimateModels.git_log_prm</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">git_log_prm(x :: AbstractModelConfig,msg,commit_msg)</code></pre><p>Add files found in <code>tracked_parameters/</code> (if any) to git log.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL418-L422">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.git_log_show" href="#ClimateModels.git_log_show"><code>ClimateModels.git_log_show</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">git_log_show(x :: AbstractModelConfig)</code></pre><p>Show git log.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/interface.jl#LL458-L462">source</a></section></article><h2 id="Cloud-Support"><a class="docs-heading-anchor" href="#Cloud-Support">Cloud Support</a><a id="Cloud-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-Support" title="Permalink"></a></h2><p>There are various ways that model output gets archived, distributed, and retrieved from the internet. In some cases downloading data can be the most convenient approach. In others it can be more advantageous to compute in the cloud and only download final results for plotting (e.g. <code>cmip</code>).</p><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.cmip" href="#ClimateModels.cmip"><code>ClimateModels.cmip</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cmip(institution_id,source_id,variable_id)</code></pre><p>Access CMIP6 climate model archive (https://bit.ly/2WiWmoh) via <code>AWS.jl</code> and <code>Zarr.jl</code> and compute (1) time mean global map and (2) time evolving global mean.</p><p>This example was partly inspired by @rabernat &#39;s https://bit.ly/2VRMgvl notebook</p><pre><code class="nohighlight hljs">using ClimateModels
(mm,gm,meta)=cmip()
nm=meta[&quot;long_name&quot;]*&quot; in &quot;*meta[&quot;units&quot;]

using Plots
heatmap(mm[&quot;lon&quot;], mm[&quot;lat&quot;], transpose(mm[&quot;m&quot;]),
        title=nm*&quot; (time mean)&quot;)
plot(gm[&quot;t&quot;][1:12:end],gm[&quot;y&quot;][1:12:end],xlabel=&quot;time&quot;,ylabel=nm,
     title=meta[&quot;institution_id&quot;]*&quot; (global mean, month by month)&quot;)
display.([plot!(gm[&quot;t&quot;][i:12:end],gm[&quot;y&quot;][i:12:end], leg = false) for i in 2:12])

</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/fd8c70b1dff023f62db061da9944d7154c05ee7f/src/access.jl#LL4-L27">source</a></section></article><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><ul><li><a href="#ClimateModels.ModelConfig"><code>ClimateModels.ModelConfig</code></a></li><li><a href="#ClimateModels.build"><code>ClimateModels.build</code></a></li><li><a href="#ClimateModels.clean"><code>ClimateModels.clean</code></a></li><li><a href="#ClimateModels.cmip"><code>ClimateModels.cmip</code></a></li><li><a href="#ClimateModels.compile"><code>ClimateModels.compile</code></a></li><li><a href="#ClimateModels.git_log_fil"><code>ClimateModels.git_log_fil</code></a></li><li><a href="#ClimateModels.git_log_init"><code>ClimateModels.git_log_init</code></a></li><li><a href="#ClimateModels.git_log_msg"><code>ClimateModels.git_log_msg</code></a></li><li><a href="#ClimateModels.git_log_prm"><code>ClimateModels.git_log_prm</code></a></li><li><a href="#ClimateModels.git_log_show"><code>ClimateModels.git_log_show</code></a></li><li><a href="#ClimateModels.launch"><code>ClimateModels.launch</code></a></li><li><a href="#ClimateModels.monitor"><code>ClimateModels.monitor</code></a></li><li><a href="#ClimateModels.setup"><code>ClimateModels.setup</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Guide  »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.6 on <span class="colophon-date" title="Wednesday 8 September 2021 03:21">Wednesday 8 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
