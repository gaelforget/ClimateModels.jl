<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · ClimateModels.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimateModels.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#Climate-Model-Interface"><span>Climate Model Interface</span></a></li><li><a class="tocitem" href="#Git-/-Log-Support"><span>Git / Log Support</span></a></li><li><a class="tocitem" href="#Cloud-/-File-Support"><span>Cloud / File Support</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gaelforget/ClimateModels.jl/blob/master/docs/src/functionalities.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="manual"><a class="docs-heading-anchor" href="#manual">User Manual</a><a id="manual-1"></a><a class="docs-heading-anchor-permalink" href="#manual" title="Permalink"></a></h1><p>Here we document key functionalities offered in <code>ClimateModels.jl</code></p><ul><li>Climate Model Interface</li><li>Tracked Worklow Framework</li><li>Cloud + On-Premise File Support</li></ul><h2 id="Climate-Model-Interface"><a class="docs-heading-anchor" href="#Climate-Model-Interface">Climate Model Interface</a><a id="Climate-Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Climate-Model-Interface" title="Permalink"></a></h2><p>The climate model interface is based on the <a href="#ClimateModels.ModelConfig"><code>ModelConfig</code></a> data structure and a series of methods like <a href="#ClimateModels.setup"><code>setup</code></a>, <a href="#ClimateModels.build"><code>build</code></a>, and <a href="#ClimateModels.launch"><code>launch</code></a>. The typical sequence is shown just below where <code>f</code> is a function that (1) receives a <code>ModelConfig</code> as its only input argument, and (2) gets called via <a href="#ClimateModels.launch"><code>launch</code></a>. </p><pre><code class="language- hljs">using ClimateModels #hide
f=ClimateModels.RandomWalker #hide
MC=ModelConfig(model=f)
setup(MC)
build(MC)
launch(MC)</code></pre><p>The <code>ModelConfig</code> called <code>MC</code> is summarized using the <a href="#Base.show"><code>show</code></a> method which here reveals that <code>f</code> is just an alias for <code>ClimateModels.RandomWalker</code>. The run folder name can be accessed directly using <a href="#Base.pathof"><code>pathof</code></a>.</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  ID            = 6e8444b3-220f-402e-9224-dbd11b513790
  model         = RandomWalker
  configuration = anonymous
  run folder    = /tmp/6e8444b3-220f-402e-9224-dbd11b513790
  log subfolder = /tmp/6e8444b3-220f-402e-9224-dbd11b513790/log
  task(s)       = RandomWalker
</code></pre><p>The content of the run folder is readily inspected using <a href="."><code>readdir</code></a>.</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{String}:
 &quot;log&quot;</code></pre><p>Here <code>launch(MC)</code> has completed, <code>RandomWalker.csv</code> is a file that was generated by function <code>f</code>, and <code>log</code> is the log subfolder that was created by <a href="#ClimateModels.setup"><code>setup</code></a>. </p><p>The workflow log is retrieved using the <a href="#Base.log"><code>log</code></a> function. </p><pre><code class="language- hljs">log(MC) #hide</code></pre><p>This highlights that <code>Project.toml</code> and <code>Manifest.toml</code> for the environment being used have been archived. This happens during <a href="#ClimateModels.setup"><code>setup</code></a> to document all dependencies and make the workflow reproducible.</p><h3 id="Generalization"><a class="docs-heading-anchor" href="#Generalization">Generalization</a><a id="Generalization-1"></a><a class="docs-heading-anchor-permalink" href="#Generalization" title="Permalink"></a></h3><p>A key point is that everything can be customized to, e.g., use popular models previously written in Fortran or C just as simply. This typically involves defining a new concrete type of <code>AbstractModelConfig</code> and providing a customized <code>build</code> method to compile the model. </p><p>This approach is illustrated in the <a href="../examples/#examples">examples</a> as well as in the suite of general circulation model examples that uses the customized interface elements provided by <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a> for <a href="https://mitgcm.readthedocs.io/en/latest/">MITgcm</a>.</p><p>The idea in the longer term is that for popular models the customized interface elements would be provided via a dedicated package (e.g. <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a>). These customized interfaces would thus be maintained independently by developers and users most familiar with each model.</p><h2 id="Git-/-Log-Support"><a class="docs-heading-anchor" href="#Git-/-Log-Support">Git / Log Support</a><a id="Git-/-Log-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Git-/-Log-Support" title="Permalink"></a></h2><p>The <code>setup</code> method normally calls <a href="#Base.log"><code>log</code></a> to set up a temporary run folder with a <code>git</code> enabled subfolder called <code>log</code>. This allows for recording each workflow step, using <code>log</code> functions listed below.</p><article class="docstring"><header><a class="docstring-binding" id="Base.log" href="#Base.log"><code>Base.log</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">log(x :: AbstractModelConfig)</code></pre><p>Show the record of git commits that have taken place in the <code>log</code> folder.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL490-L494">source</a></section><section><div><pre><code class="nohighlight hljs">log(x :: AbstractModelConfig, commit_msg :: String; 
             fil=&quot;&quot;, msg=&quot;&quot;, init=false, prm=false)</code></pre><ul><li>init=true : create <code>log</code> subfolder, initialize git, and commit initial README.md</li><li>prm=true  : add files found in <code>input</code> or <code>tracked_parameters/</code> (if any) to git log</li><li>!isempty(fil) : commit changes to file <code>log/fil</code> with message <code>commit_msg</code>.  If <code>log/fil</code> is unknown to git (i.e. commit errors out) then try adding <code>log/fil</code> first. </li></ul><pre><code class="language-julia hljs">using ClimateModels

f=ClimateModels.RandomWalker
i=ClimateModels.OrderedDict(); i[&quot;NS&quot;]=100

tmp=ModelConfig(model=f,inputs=i)
setup(tmp)
build(tmp)
launch(tmp)

log(tmp,
    &quot;update tracked_parameters.toml (or skip)&quot;, 
    fil=&quot;tracked_parameters.toml&quot;)
ClimateModels.@suppress log(tmp)
isa(tmp,AbstractModelConfig)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL497-L527">source</a></section></article><h2 id="Cloud-/-File-Support"><a class="docs-heading-anchor" href="#Cloud-/-File-Support">Cloud / File Support</a><a id="Cloud-/-File-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-/-File-Support" title="Permalink"></a></h2><p>There are various ways that model output gets archived, distributed, and retrieved from the internet (e.g., see <a href="#ClimateModels.cmip"><code>cmip</code></a>). In some cases downloading data can be the most convenient approach. In others it can be more advantageous to compute in the cloud and only download final results for plotting. </p><p><code>ClimateModels.jl</code> comes equiped with packages that read popular file formats used in climate modeling and science. <a href="https://github.com/JuliaLang/Downloads.jl">Downloads.jl</a>, <a href="https://github.com/JuliaData/CSV.jl">CSV.jl</a>, <a href="https://github.com/JuliaData/DataFrames.jl">DataFrames.jl</a>, <a href="https://github.com/JuliaGeo/NetCDF.jl">NetCDF.jl</a>, <a href="https://github.com/meggart/Zarr.jl">Zarr.jl</a>, and <a href="https://github.com/JuliaLang/TOML.jl">TOML.jl</a> are thus readily available when you install <code>ClimateModels.jl</code>. </p><p>For example, one can read the CSV file generated by <code>ClimateModels.RandomWalker</code> as follows:</p><pre><code class="language- hljs">fil=joinpath(pathof(MC),&quot;RandomWalker.csv&quot;)
ClimateModels.CSV.File(fil) |&gt; ClimateModels.DataFrame
show(ans) #hide</code></pre><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><ul><li><a href="#ClimateModels.ModelConfig"><code>ClimateModels.ModelConfig</code></a></li><li><a href="#Base.Filesystem.readdir"><code>Base.Filesystem.readdir</code></a></li><li><a href="#Base.log"><code>Base.log</code></a></li><li><a href="#Base.pathof"><code>Base.pathof</code></a></li><li><a href="#Base.show"><code>Base.show</code></a></li><li><a href="#ClimateModels.build"><code>ClimateModels.build</code></a></li><li><a href="#ClimateModels.clean"><code>ClimateModels.clean</code></a></li><li><a href="#ClimateModels.cmip"><code>ClimateModels.cmip</code></a></li><li><a href="#ClimateModels.launch"><code>ClimateModels.launch</code></a></li><li><a href="#ClimateModels.setup"><code>ClimateModels.setup</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.ModelConfig" href="#ClimateModels.ModelConfig"><code>ClimateModels.ModelConfig</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct ModelConfig &lt;: AbstractModelConfig</code></pre><pre><code class="nohighlight hljs">model :: Union{Function,String,Pkg.Types.PackageSpec} = &quot;anonymous&quot;
configuration :: Union{Function,String} = &quot;anonymous&quot;
options :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
inputs :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
outputs :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
status :: OrderedDict{Any,Any} = OrderedDict{Any,Any}()
channel :: Channel{Any} = Channel{Any}(10) 
folder :: String = tempdir()
ID :: UUID = UUIDs.uuid4()</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL6-L20">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.setup" href="#ClimateModels.setup"><code>ClimateModels.setup</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup(x)</code></pre><p>Defaults to <code>default_ClimateModelSetup(x)</code>. Can be expected to be  specialized for most concrete types of <code>AbstractModelConfig</code></p><pre><code class="nohighlight hljs">f=ClimateModels.RandomWalker
tmp=ModelConfig(model=f)
setup(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL47-L58">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.build" href="#ClimateModels.build"><code>ClimateModels.build</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">build(x)</code></pre><p>Defaults to <code>default_ClimateModelBuild(x)</code>. Can be expected to be  specialized for most concrete types of <code>AbstractModelConfig</code></p><pre><code class="language-julia hljs">using ClimateModels
tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
build(tmp)

isa(tmp,AbstractModelConfig)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL171-L189">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.launch" href="#ClimateModels.launch"><code>ClimateModels.launch</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">launch(x)</code></pre><p>Defaults to <code>default_ClimateModelLaunch(x)</code> which consists in <code>take!(x)</code> for <code>AbstractModelConfig</code>. Can be expected to be specialized for most  concrete types of <code>AbstractModelConfig</code></p><pre><code class="nohighlight hljs">f=ClimateModels.RandomWalker
tmp=ModelConfig(model=f)
setup(tmp)
build(tmp)
launch(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL227-L241">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.show" href="#Base.show"><code>Base.show</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">show(io::IO, z::AbstractModelConfig)</code></pre><pre><code class="nohighlight hljs">tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
show(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL296-L304">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.pathof" href="#Base.pathof"><code>Base.pathof</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pathof(x::AbstractModelConfig)</code></pre><p>Returns the run directory path for x ; i.e. joinpath(x.folder,string(x.ID))</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL33-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.Filesystem.readdir" href="#Base.Filesystem.readdir"><code>Base.Filesystem.readdir</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">readdir(x::AbstractModelConfig)</code></pre><p>Same as readdir(pathof(x)).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL40-L44">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.clean" href="#ClimateModels.clean"><code>ClimateModels.clean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">clean(x :: AbstractModelConfig)</code></pre><p>Cancel any remaining task (x.channel) and rm the run directory (pathof(x))</p><pre><code class="nohighlight hljs">tmp=ModelConfig(model=ClimateModels.RandomWalker)
setup(tmp)
clean(tmp)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/interface.jl#LL248-L258">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateModels.cmip" href="#ClimateModels.cmip"><code>ClimateModels.cmip</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cmip(institution_id,source_id,variable_id)</code></pre><p>Access CMIP6 climate model archive (https://bit.ly/2WiWmoh) via <code>AWS.jl</code> and <code>Zarr.jl</code> and compute (1) time mean global map and (2) time evolving global mean.</p><p>This example was partly inspired by @rabernat &#39;s https://bit.ly/2VRMgvl notebook</p><pre><code class="nohighlight hljs">using ClimateModels
(mm,gm,meta)=cmip()
nm=meta[&quot;long_name&quot;]*&quot; in &quot;*meta[&quot;units&quot;]

using Plots
heatmap(mm[&quot;lon&quot;], mm[&quot;lat&quot;], transpose(mm[&quot;m&quot;]),
        title=nm*&quot; (time mean)&quot;)
plot(gm[&quot;t&quot;][1:12:end],gm[&quot;y&quot;][1:12:end],xlabel=&quot;time&quot;,ylabel=nm,
     title=meta[&quot;institution_id&quot;]*&quot; (global mean, month by month)&quot;)
display.([plot!(gm[&quot;t&quot;][i:12:end],gm[&quot;y&quot;][i:12:end], leg = false) for i in 2:12])

</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gaelforget/ClimateModels.jl/blob/9d427a8381ee72ba7a1330db659484513c7817b6/src/access.jl#LL4-L27">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Sunday 2 January 2022 16:15">Sunday 2 January 2022</span>. Using Julia version 1.7.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
