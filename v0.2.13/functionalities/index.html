<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Manual · ClimateModels.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimateModels.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>User Manual</a><ul class="internal"><li><a class="tocitem" href="#Climate-Model-Interface"><span>Climate Model Interface</span></a></li><li><a class="tocitem" href="#Tracked-Worklow-Support"><span>Tracked Worklow Support</span></a></li><li><a class="tocitem" href="#Files-and-Cloud-Support"><span>Files and Cloud Support</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../API/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gaelforget/ClimateModels.jl/blob/master/docs/src/functionalities.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="manual"><a class="docs-heading-anchor" href="#manual">User Manual</a><a id="manual-1"></a><a class="docs-heading-anchor-permalink" href="#manual" title="Permalink"></a></h1><p>Here we document key functionalities offered in <code>ClimateModels.jl</code></p><ul><li>Climate Model Interface</li><li>Tracked Worklow Framework</li><li>Cloud + On-Premise File Support</li></ul><h2 id="Climate-Model-Interface"><a class="docs-heading-anchor" href="#Climate-Model-Interface">Climate Model Interface</a><a id="Climate-Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Climate-Model-Interface" title="Permalink"></a></h2><p>The interface ties the <a href="../API/#ClimateModels.ModelConfig"><code>ModelConfig</code></a> data structure with methods like <a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a>, <a href="../API/#ClimateModels.build"><code>build</code></a>, and <a href="../API/#ClimateModels.launch"><code>launch</code></a>. In return, it provides standard methods to deal with inputs and outputs, as well as capabilities described below. </p><p>The <a href="../API/#Base.run"><code>run</code></a> method provides the capability to deploy models in streamlined fashion – with just one code line, or just one click. It executes all three steps at once (<a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a>, <a href="../API/#ClimateModels.build"><code>build</code></a>, and <a href="../API/#ClimateModels.launch"><code>launch</code></a>). </p><p>With the simplified <a href="../API/#ClimateModels.ModelConfig"><code>ModelConfig</code></a> constructor, we can then just write:</p><pre><code class="language-julia hljs">f=ClimateModels.RandomWalker
run(ModelConfig(f))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  ID            = 32032506-bb1c-4863-b610-f3db39e117eb
  model         = RandomWalker
  configuration = anonymous
  run folder    = /tmp/32032506-bb1c-4863-b610-f3db39e117eb
  log subfolder = /tmp/32032506-bb1c-4863-b610-f3db39e117eb/log
</code></pre><p>The above example uses <code>ClimateModels.RandomWalker</code> as the model (function <code>f</code>). By design of our interface, it is <strong>required</strong> that <code>f</code> receives a <code>ModelConfig</code> as its sole input argument. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In practice, this requirement is easily satisfied. Input parameters can be specified to <code>ModelConfig</code> via the <code>inputs</code> keyword argument, or via files instead. See <a href="#Parameters">Parameters</a>.</p></div></div><p>Often it is most practical to break things down. Let&#39;s start with defining the model:</p><pre><code class="language-julia hljs">MC=ModelConfig(model=f)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  ID            = 24e0725f-4794-4fce-9b20-d6f65ee1a22b
  model         = RandomWalker
  configuration = anonymous
  run folder    = /tmp/24e0725f-4794-4fce-9b20-d6f65ee1a22b
  log subfolder = /tmp/24e0725f-4794-4fce-9b20-d6f65ee1a22b/log
</code></pre><p>The <code>model</code>&#39;s top level function gets called via <a href="../API/#ClimateModels.launch"><code>launch</code></a>. In our example, <code>f</code> thus generates a file called <code>RandomWalker.csv</code>, which gets stored in the run folder. </p><p>The <code>run</code> sequence is shown below. In practice, <code>setup</code> typically handles files and software, <code>build</code> may compile a chosen model configuration, and <code>launch</code> takes care of the main computation. </p><pre><code class="language-julia hljs">setup(MC)
build(MC)
launch(MC)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Compilation during <code>build</code> is <strong>not a requirement</strong>. It can also be done within <code>launch</code> or beforehand.</p></div></div><p>Sometimes it is convenient to further break down the computational workflow into several tasks. These can be added to the <code>ModelConfig</code> via <a href="@ref"><code>put!</code></a> and then executed via <code>launch</code>, as demonstrated in <a href="#Parameters">Parameters</a>.</p><p>The run folder name and its content can be viewed using <a href="../API/#Base.pathof"><code>pathof</code></a> and <a href="../API/#Base.Filesystem.readdir"><code>readdir</code></a>, respectively.</p><pre><code class="language-julia hljs">pathof(MC)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/tmp/24e0725f-4794-4fce-9b20-d6f65ee1a22b&quot;</code></pre><pre><code class="language-julia hljs">readdir(MC)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{String}:
 &quot;RandomWalker.csv&quot;
 &quot;log&quot;</code></pre><p>The <code>log</code> subfolder was created earlier by <a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a>. The <a href="../API/#Base.log"><code>log</code></a> function retrieves the workflow log. </p><pre><code class="language-julia hljs">log(MC)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{String}:
 &quot;7f02d74 initial setup&quot;
 &quot;a11174a add Project.toml to log&quot;
 &quot;e6b9ad3 add Manifest.toml to log&quot;
 &quot;7539ce0 task started [1b4416e9-a356-4b78-8a85-65149103e1dc]&quot;
 &quot;56c39fa (HEAD -&gt; main) task ended   [1b4416e9-a356-4b78-8a85-65149103e1dc]&quot;</code></pre><p>This highlights that <code>Project.toml</code> and <code>Manifest.toml</code> for the environment being used have been archived. This happens during <a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a> to document all dependencies and make the workflow reproducible.</p><h3 id="Customization"><a class="docs-heading-anchor" href="#Customization">Customization</a><a id="Customization-1"></a><a class="docs-heading-anchor-permalink" href="#Customization" title="Permalink"></a></h3><p>A key point is that everything can be customized to, e.g., use popular models previously written in Fortran or C just as simply. </p><p>The simplest way to use the <code>ClimateModels.jl</code> interface is to specify <code>model</code> directly as a function, and use defaults for everything else, as illustrated in <a href="../examples/RandomWalker.html">random walk</a>. Alternatively, the <code>model</code> name can be provided as a <code>String</code> and the main <code>Function</code> as the <code>configuration</code>, as in <a href="../examples/CMIP6.html">CMIP6</a>.</p><p>Often, however, one may want to define custom <code>setup</code>, <code>build</code>, or <code>launch</code> methods. To this end, one can define a concrete type of <code>AbstractModelConfig</code> using <a href="../API/#ClimateModels.ModelConfig"><code>ModelConfig</code></a> as a blueprint. This is the recommended approach when other languanges like Fortran or Python are involved (e.g., <a href="../examples/Hector.html">Hector</a>, <a href="../examples/FaIR.html">FaIR</a>, <a href="../examples/Speedy.html">SPEEDY</a>, <a href="../examples/MITgcm.html">MITgcm</a>). </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Defining a concrete type of <code>AbstractModelConfig</code> can also be practical with pure Julia model, e.g. to speed up <a href="../API/#ClimateModels.launch"><code>launch</code></a>, generate ensembles, facilitate checkpointing, etc. That&#39;s the case in the <a href="../examples/Oceananigans.html">Oceananigans.jl</a> example.</p></div></div><p>For popular models the customized interface elements can be provided via a dedicated package. This may allow them to be maintained independently by developers and users most familiar with each model. <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a> does this for <a href="https://mitgcm.readthedocs.io/en/latest/">MITgcm</a>. It provides its own suite of examples that use the <code>ClimateModels.jl</code> interface.</p><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><p>In this example, we illustrate how one can interact with model parameters and rerun a model. After an initial model run of 100 steps, duration <code>NS</code> is extended to 200 time steps. The <a href="@ref"><code>put!</code></a> and <a href="../API/#ClimateModels.launch"><code>launch</code></a> sequence then reruns the model. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The same method can be used to break down a workflow in several steps. Each call to <code>launch</code> sequentially takes the next task from the stack (i.e., <code>channel</code>). Once the task <code>channel</code> is empty then <code>launch</code> does nothing.</p></div></div><pre><code class="language-julia hljs">MC=ModelConfig(f,(NS=100,filename=&quot;run01.csv&quot;))
run(MC)

MC.inputs[:NS]=200
MC.inputs[:filename]=&quot;run02.csv&quot;
put!(MC)
launch(MC)

log(MC)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">9-element Vector{String}:
 &quot;1911b44 initial setup&quot;
 &quot;7321d32 initial tracked_parameters.toml&quot;
 &quot;565e19f add Project.toml to log&quot;
 &quot;4548557 add Manifest.toml to log&quot;
 &quot;312eb26 task started [d1d1872a-a937-49b6-83c8-25bffa2454a1]&quot;
 &quot;b718eac task ended   [d1d1872a-a937-49b6-83c8-25bffa2454a1]&quot;
 &quot;a80bf05 task started [f6c96aca-283a-484b-bf58-08ca3de3533e]&quot;
 &quot;e902aec modify tracked_parameters.toml&quot;
 &quot;a9f9595 (HEAD -&gt; main) task ended   [f6c96aca-283a-484b-bf58-08ca3de3533e]&quot;</code></pre><p>The call sequence is readily reflected in the workflow log (see <a href="#Tracked-Worklow-Support">Tracked Worklow Support</a>), and the run folder now has two output files.</p><pre><code class="language-julia hljs">readdir(MC)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{String}:
 &quot;log&quot;
 &quot;run01.csv&quot;
 &quot;run02.csv&quot;
 &quot;tmp.txt&quot;</code></pre><p>In more complex models, there generally is a large number of parameters that are often organized in a collection of text files. </p><p>The <code>ClimateModels.jl</code> interface can easily be customized to turn these parameter sets into a <code>tracked_parameters.toml</code> file as illustrated in our <a href="../examples/#run_model_examples">Hector example</a> and in the <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl examples</a>.</p><p><code>ClimateModels.jl</code> thus readily enables interacting with parameters and tracking their values even with complex models as highlighted in the <a href="@ref">JuliaCon 2021 Presentation</a>.</p><h2 id="Tracked-Worklow-Support"><a class="docs-heading-anchor" href="#Tracked-Worklow-Support">Tracked Worklow Support</a><a id="Tracked-Worklow-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Tracked-Worklow-Support" title="Permalink"></a></h2><p>When creating a <code>ModelConfig</code>, it receives a unique identifier (<code>UUIDs.uuid4()</code>). By default, this identifier is used in the name of the run folder attached to the <code>ModelConfig</code>. </p><p>The run folder normally gets created by <a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a>, which itself calls <a href="../API/#Base.log"><code>log</code></a> to create a <code>git</code> enabled subfolder called <code>log</code>. This allows for recording each workflow step via the <a href="../API/#Base.log"><code>log</code></a> methods. </p><p>As shown in the <a href="#Parameters">Parameters</a> example:</p><ul><li>Parameters specified via a <code>ModelConfig</code>&#39;s <code>inputs</code> are automatically recorded into <code>tracked_parameters.toml</code> during <a href="../API/#ClimateModels.setup-Tuple{ModelConfig}"><code>setup</code></a>.</li><li>Modified parameters are automatically recorded in <code>tracked_parameters.toml</code> during <a href="../API/#ClimateModels.launch"><code>launch</code></a>.</li><li>Calling <a href="../API/#Base.log"><code>log</code></a> on a <a href="../API/#ClimateModels.ModelConfig"><code>ModelConfig</code></a> without any other argument shows the workflow record.</li></ul><h2 id="Files-and-Cloud-Support"><a class="docs-heading-anchor" href="#Files-and-Cloud-Support">Files and Cloud Support</a><a id="Files-and-Cloud-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Files-and-Cloud-Support" title="Permalink"></a></h2><p>There are various ways that numerical model output gets archived to, distributed through, and retrieved from the internet. In some cases downloading data can be the most convenient approach. In others it can be more advantageous to compute in the cloud and only download final results for plotting. </p><p><code>ClimateModels.jl</code> leverages mature Julia packages to read common file formats used in climate modeling and science. <a href="https://github.com/JuliaLang/Downloads.jl">Downloads.jl</a>, <a href="https://github.com/JuliaData/DataFrames.jl">DataFrames.jl</a>, <a href="https://github.com/JuliaData/CSV.jl">CSV.jl</a>, and <a href="https://github.com/JuliaLang/TOML.jl">TOML.jl</a> are direct dependencies of <code>ClimateModels.jl</code>.</p><pre><code class="language- hljs">fil=joinpath(pathof(MC),&quot;RandomWalker.csv&quot;)
CSV=ClimateModels.CSV # hide
DataFrame=ClimateModels.DataFrame #hide
CSV.File(fil) |&gt; DataFrame
summary(ans) # hide</code></pre><p>For examples with <a href="https://github.com/JuliaGeo/NetCDF.jl">NetCDF</a> and <a href="https://github.com/meggart/Zarr.jl">Zarr</a>, please refer to <a href="../examples/IPCC.html">IPCC notebook</a> (NetCDF) and <a href="../examples/CMIP6.html">CMIP6 notebok</a> (Zarr).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 5 October 2022 01:44">Wednesday 5 October 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
